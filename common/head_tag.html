<script type='text/x-handlebars' data-template-name='/connectors/above-footer/add-landing-page-footer'>
  <div class="homepage-footer">
    <footer class="gds-Hero gds-Hero--alternate Hero--welcome">
      <div class="gds-Hero-container gds-Hero-container--center">
        <h1>
          <div class="gds-Hero-title call-out">New Here?</div>
        </h1>
        <h3>
          <div class="gds-Hero-subtitle">Take a quick second to say hi!</div>
        </h3>
        <div class="gds-Hero-cta">
          <a id="introduction-link" href="#" class="gds-Button gds-Button--alternate">Introduce Yourself</a>
        </div>
      </div>
    </footer>
  </div>
</script>
<script type="text/discourse-plugin" version="0.8.13">
  $(document).ready(function() {
    $('#introduction-link').attr("href", settings.introduce_yourself);
  });
</script>
<script type='text/x-handlebars' data-template-name='/connectors/below-site-header/add-landing-page-content'>
  <div class="homepage-wrapper">
    <header class="gds-Hero gds-Hero--alternate Hero--welcome">
      <div class="triangle-topleft"></div>
      <div class="triangle-bottomright"></div>
      <div class="gds-Hero-container gds-Hero-container--center">
        <h1>
          <div class="gds-Hero-title">Welcome.</div>
        </h1>
        <h3>
          <div class="gds-Hero-subtitle">Ask a Question, Share Your Store, Celebrate Wins Big or Small.</div>
        </h3>
        <div class="gds-Hero-cta">
          <a id="daily-check-in" href="#" class="gds-Button gds-Button--alternate">Daily Check In</a>
        </div>
      </div>
    </header>

    <div class="contained-row">
      <div class="startHere-wrapper">
        <div class="startHere">
          <div class="startHere-header">
            <h2>Start Here</h2>
          </div>
          <div class="contents posts--startHere posts-wrapper">
            <table class="topic-list">
              <tbody id="StartHereResults"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="popular-wrapper">
        <div class="popular">
          <div class="popular-header">
            <h2>Popular</h2>
          </div>
          <div id="popular-items-results" class="popular-items"></div>
        </div>
      </div>
    </div>

    <div class="questions-wrapper container">
      <div class="gds-FeatureGroup gds-FeatureGroup--withoutDividers">
        <h2 class="gds-Heading gds-Heading--secondary">Can you <span class="call-out">Answer These</span> questions?</h2>
        <ul id="question-cards" class="gds-FeatureGroup-list"></ul>
      </div>
    </div>

  </div>
</script>
<script type="text/discourse-plugin" version="0.8.13">
  $(document).ready(function() {
    $('#daily-check-in').attr("href", settings.daily_check_in);
  });
</script>
<script id="popular-item-template" type="text/x-handlebars-template">
  {{#each this}}
    <div class="popular-item">
      <a href="{{link}}" class="popular-link">
        <div class="popular-icon"><img src="{{icon}}" /></div>
        <div class="popular-description">{{title}}</div>
      </a>
    </div>
  {{/each}}
</script>

<script>
  $(function() {
    var source = $("#popular-item-template").html();
    var template = Handlebars.compile(source);
    var popular = [{ title: "Budget",
                      link: "/tags/budget",
                      icon: "image.png"
                    },
                    {
                      title: "Beat Debt",
                      link: "/tags/beat-debt",
                      icon: "image.png"
                    },
                    {
                      title: "Savings",
                      link: "/tags/savings",
                      icon: "image.png"
                    },
                    {
                      title: "Retirement",
                      link: "/tags/retirement",
                      icon: "image.png"
                    },
                    {
                      title: "Celebrations & Milestones",
                      link: "/tags/celebrations",
                      icon: "image.png"
                    },
                    {
                      title: "Start New",
                      link: "",
                      icon: "image.png"
                    }]
    var html = template(popular);
    $('#popular-items-results').html(html);
  });
</script>
<script id="question-card-template" type="text/x-handlebars-template">
  {{#each this}}
    <li class='gds-FeatureGroup-feature'>
      <div class='topic-poster'>
        <a href="/u/{{post.username}}" data-user-card="{{post.username}}">
          {{avatar post imageSize="large"}}
        </a>
      </div>
      <div class='gds-Card-body'>
        <h3 class='gds-Heading gds-Heading--tertiary gds-Card-title'></h3>
        <div class='gds-Text gds-Card-text'>
          <p>{{post.blurb}}</p> 
          Updated {{updated}} <br>by <strong>  <a href="/u/{{post.username}}" data-user-card="{{post.username}}">{{post.username}}</a></strong></div>
        <a href='/t/{{topic.slug}}/{{topic.id}}' class='gds-Button'>Comment</a>
      </div>
    </li>
  {{/each}}
</script>

<script type="text/javascript">
    var createdCards = false;
    Discourse.Route.reopen({
        activate: function() {
            this._super();
            Em.run.next(function() {
                if (window.location.pathname == "/") {
                    createdCards = false;
                    createCards();
                }
            });
        }
    });

    function createCards() {
        if (createdCards === true) return;
        var dataPath = "/search.json?expanded=true&q=after:" + getPastDate() + "&status:noreplies";
        $.get(dataPath, cardDataSuccess);
        createdCards = true;
    };

    function cardDataSuccess(resp, status, ele) {
        var source = $("#question-card-template").html();
        var template = Handlebars.compile(source);
        var cards = new Array();

        if (resp.posts.length >= 3) {
            var arraylength = 3;
        } else {
            var arraylength = resp.posts.length;
        }

        for (var i = 0; i < arraylength; i++) {
            var post = resp.posts[i];
            var topic = findElement(resp.topics, "id", post.topic_id);
            var d = new Date(topic.bumped_at);
            var updated = moment(d, "ddd MMMM DD YYYY hh:mm:ss").fromNow();
            var card = {
                post: post,
                topic: topic,
                updated: updated
            }
            cards.push(card);
        }
        var html = template(cards);
        $('#question-cards').html(html);
    }

    function findElement(arr, propName, propValue) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i][propName] == propValue) {
                return arr[i];
            }
        }
    }

    function getPastDate() {
        var pastDate = new Date();
        var dayOfMonth = pastDate.getDate();
        return pastDate.setDate(dayOfMonth - 1);
    }
</script>
<script>
    $(function() {
        var source = $("#start-here-template").html();
        var template = Handlebars.compile(source);
        var data = $.get("/c/get-started.json", startHereDataSuccess);
    });

    function startHereDataSuccess(resp, status, ele) {
        var source = $("#start-here-template").html();
        var template = Handlebars.compile(source);
        var html = template(resp.topic_list.topics);
        $('#StartHereResults').html(html);
    }
</script>

<script id="start-here-template" type="text/x-handlebars-template">
    {{#each this}}
    <tr class="topic-list-item category-uncategorized {{#if pinned}}pinned {{/if}}ember-view">
        <td class="main-link clearfix" colspan="2">
          <span class="link-top-line">
            <div class="topic-statuses">
              <a href="/t/{{slug}}/{{id}}" title="{{title}}" class="topic-status">
                <i class="fa fa-thumb-tack d-icon d-icon-thumb-tack"></i>
              </a>
            </div>
            <a href="/t/{{slug}}/{{id}}" class="title raw-link raw-topic-link">{{title}}</a>
            <span class="topic-post-badges">  </span>
          </span>
          <div class="topic-excerpt">
              {{excerpt}}
              <a href="/t/{{slug}}/{{id}}">read more</a>
          </div>
          <div class='creator'>
            {{#if showCategory}} {{category-link category}} {{/if}} 
            {{~#if creator ~}}
             <a href="/users/{{creator.username}}" data-auto-route="true" data-user-card="{{creator.username}}">{{creator.username}}</a> <a href={{url}}>{{format-date createdAt format="tiny"}}</a> 
            {{~/if ~}} 
            {{raw "list/action-list"
            topic=topic postNumbers=liked_post_numbers className="likes" icon="heart"}}
        </div>
      </td>
      <td class="last-post">
          <div class='poster-avatar'>
              <a href="{{lastPostUr}}" data-user-card="{{last_poster_username}}">{{avatar lastPoster usernamePath="username" imageSize="medium"}}</a>
          </div>
          <div class='poster-info'>
              <a href="{{lastPostUrl}}">{{format-date bumpedAt format="tiny"}} </a>
              <span class='editor'><a href="/users/{{last_poster_username}}" data-auto-route="true" data-user-card="{{last_poster_username}}">{{last_poster_username}}</a></span>
          </div>
      </td>
      <td class="num age activity" title="First post: {{created_at}}">
          <a class="post-activity" href="/t/{{slug}}/{{id}}">
              <span class="relative-date" data-time="{{created_at}}" data-format="tiny">12d</span>
          </a>
      </td>
    </tr>
    {{/each}}
</script>
